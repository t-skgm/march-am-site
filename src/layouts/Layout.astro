---
import '../styles/global.css'
import '@fontsource/lora'
import type { Props as SEOProps } from 'astro-seo'
import { SEO } from 'astro-seo'
import Logo from '../components/molecules/Logo.astro'
import Footer from '../components/molecules/Footer.astro'
import GA from '../components/molecules/GoogleAnalytics.astro'
import { site } from '../constants/site'

export interface Props {
  title?: string
  frontmatter?: any
  /** canpnicalのPath部分を上書きしたい場合 */
  canonicalPath?: string | undefined
  overrideSEOProps?: Partial<SEOProps>
}

const { title, frontmatter, canonicalPath, overrideSEOProps } = Astro.props

const articleTitle = title ?? frontmatter?.title
const pageTitle = (divider: string) =>
  articleTitle ? `${articleTitle} ${divider} ${site.title}` : site.title

const baseUrl = Astro.site ?? Astro.url
const canonicalURL = new URL(canonicalPath ?? Astro.url.pathname, baseUrl)
const socialImageURL = new URL('/assets/ogp_site.jpg', baseUrl)
---

<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <SEO
      title={pageTitle('-')}
      description={site.description}
      canonical={canonicalURL.toString()}
      openGraph={{
        basic: {
          image: socialImageURL.toString(),
          title: pageTitle('|'),
          type: 'blog'
        },
        image: {
          alt: 'Image of this site, ' + site.title
        }
      }}
      twitter={{
        card: 'summary_large_image',
        site: `@${site.author.twitter}`,
        title: pageTitle('|'),
        image: socialImageURL.toString(),
        imageAlt: 'Image of this site, ' + site.title
      }}
      extend={{
        link: [
          { rel: 'icon', href: '/favicon.svg', type: 'image/svg+xml' },
          {
            rel: 'alternate',
            type: 'application/rss+xml',
            href: '/feed',
            title: `${site.title} feed`
          }
        ]
      }}
      {...overrideSEOProps}
    />
    <GA gtagId={import.meta.env.PUBLIC_GA_TRACKING_ID} />
  </head>

  <body>
    <Logo />
    <!-- <Header /> -->
    <div class="content">
      <slot />
    </div>
    <Footer />

    <style>
      body {
        background: repeat-y 0 / 50px url(/assets/images/back_gr.jpg),
          repeat-y right 0% / 38px url(/assets/images/back_or.jpg);
        background-color: #fff;
      }

      .content {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
        background-color: rgb(247, 248, 247, 0.75);
        margin: 0 50px 0 40px;
        padding-bottom: 10rem;
      }

      /* Bird. */
      .content::after {
        @apply block fixed;
        content: '';
        bottom: 20px;
        left: 7px;
        width: 60px;
        height: 60px;
        transform: scale(-1, 1);
        background: no-repeat 0 / 60px url(/assets/images/bird_s.png);
      }

      @media screen(lg) {
        body {
          background: repeat-y 0 / 300px url(/assets/images/back_gr.jpg),
            repeat-y right 0 url(/assets/images/back_or.jpg);
        }

        .content {
          @apply px-10 pt-10 my-0;
          min-height: calc(100vh - 16rem);
          margin-left: 300px;
          margin-right: 250px;
        }

        /* Bird. */
        .content::after {
          bottom: 60px;
          left: 60px;
          width: 120px;
          height: 120px;
          transform: scale(-1, 1);
          background-size: 120px;
        }
      }
    </style>
  </body>
</html>
